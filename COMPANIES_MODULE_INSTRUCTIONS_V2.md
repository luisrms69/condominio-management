# üìã M√≥dulo Companies - Instrucciones Corregidas y Actualizadas

## üìù **Metadatos de la Configuraci√≥n**
- **Versi√≥n:** 2.0 (Actualizada con reglas de espa√±ol)
- **Basado en:** Implementaci√≥n exitosa y correcciones aplicadas
- **Estado:** ‚úÖ Validado en entorno real 
- **Framework:** Frappe v15 / ERPNext
- **M√≥dulo:** Companies
- **DocTypes:** 12 (3 principales + 9 child tables)

---

## üá™üá∏ **REGLA CR√çTICA: ETIQUETAS EN ESPA√ëOL**

### **‚ö†Ô∏è IMPORTANTE: APLICAR SIEMPRE**
**TODAS las etiquetas (labels) y opciones DEBEN estar en espa√±ol, incluso si las instrucciones originales vienen en ingl√©s.**

#### **‚úÖ Ejemplos Correctos:**
```json
{
  "fieldname": "contract_name",        // ‚úÖ Variable en ingl√©s
  "fieldtype": "Data",
  "label": "Nombre del Contrato",      // ‚úÖ Label en espa√±ol
  "reqd": 1
}

{
  "fieldname": "contract_status",
  "fieldtype": "Select", 
  "label": "Estado del Contrato",      // ‚úÖ Label en espa√±ol
  "options": "Activo\nSuspendido\nTerminado"  // ‚úÖ Opciones en espa√±ol
}
```

#### **‚ùå Ejemplos Incorrectos:**
```json
{
  "fieldname": "contract_name",
  "label": "Contract Name",           // ‚ùå Label en ingl√©s
}

{
  "fieldname": "data_type",
  "label": "Tipo de Dato",            // ‚úÖ Label correcto
  "options": "Supplier\nItem"         // ‚ùå Opciones en ingl√©s
}
```

---

## üéØ **PASO 1: Configuraci√≥n Base Cr√≠tica**

### **1.1 Verificar/Corregir modules.txt**
```bash
# CR√çTICO: Verificar contenido actual
cat ~/frappe-bench/apps/condominium_management/condominium_management/modules.txt

# DEBE CONTENER EXACTAMENTE:
# Companies
# (Sin espacios, sin caracteres extra)

# Si est√° incorrecto, corregir:
echo "Companies" > ~/frappe-bench/apps/condominium_management/condominium_management/modules.txt
```

### **1.2 Actualizar hooks.py Completo**
```python
# ~/frappe-bench/apps/condominium_management/condominium_management/hooks.py

from . import __version__ as app_version

app_name = "condominium_management"
app_title = "Condominium Management"
app_publisher = "Buzola"
app_description = "Sistema integral de gesti√≥n de condominios"
app_email = "it@buzola.mx"
app_license = "gpl-3.0"

# CR√çTICO: No debe estar comentado
required_apps = ["frappe", "erpnext"]

# CR√çTICO: Configuraci√≥n de m√≥dulos
modules = {
    "companies": {
        "color": "blue",
        "icon": "octicon octicon-organization",
        "type": "module",
        "label": "Companies"
    }
}
```

### **1.3 Verificar Estructura de Carpetas**
```bash
# Verificar que existe y tiene estructura correcta
ls -la ~/frappe-bench/apps/condominium_management/condominium_management/companies/

# Debe mostrar:
# companies/
# ‚îú‚îÄ‚îÄ __init__.py
# ‚îú‚îÄ‚îÄ modules.txt (contiene "Companies")
# ‚îú‚îÄ‚îÄ doctype/
# ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
# ‚îÇ   ‚îî‚îÄ‚îÄ [carpetas de doctypes]
```

---

## üèóÔ∏è **PASO 2: Crear DocTypes con Comandos Correctos**

### **2.1 DocTypes Principales**
```bash
cd ~/frappe-bench

# Service Management Contract
bench make-doctype "Service Management Contract" --app condominium_management --module companies

# Master Data Sync Configuration  
bench make-doctype "Master Data Sync Configuration" --app condominium_management --module companies

# Condominium Information
bench make-doctype "Condominium Information" --app condominium_management --module companies
```

### **2.2 Child Tables**
```bash
# Contract Service Item
bench make-doctype "Contract Service Item" --app condominium_management --module companies --is-child-table

# Target Company Sync
bench make-doctype "Target Company Sync" --app condominium_management --module companies --is-child-table

# Sync Data Type
bench make-doctype "Sync Data Type" --app condominium_management --module companies --is-child-table

# Access Point Detail
bench make-doctype "Access Point Detail" --app condominium_management --module companies --is-child-table

# Contact Information
bench make-doctype "Contact Information" --app condominium_management --module companies --is-child-table

# Nearby Reference
bench make-doctype "Nearby Reference" --app condominium_management --module companies --is-child-table

# Operating Hours
bench make-doctype "Operating Hours" --app condominium_management --module companies --is-child-table

# Public Transport Option
bench make-doctype "Public Transport Option" --app condominium_management --module companies --is-child-table

# Service Information
bench make-doctype "Service Information" --app condominium_management --module companies --is-child-table
```

---

## üìù **PASO 3: Configuraci√≥n JSON con Etiquetas en Espa√±ol**

### **3.1 Service Management Contract (Ejemplo Completo)**
```json
{
 "doctype": "DocType",
 "name": "Service Management Contract",
 "module": "Companies",
 "app": "condominium_management",
 "istable": 0,
 "naming_rule": "By \"Naming Series\" field",
 "title_field": "contract_name",
 "fields": [
  {
   "fieldname": "naming_series",
   "fieldtype": "Select",
   "label": "Serie",                    // ‚úÖ Espa√±ol
   "options": "SMC-.YYYY.-",
   "reqd": 1,
   "default": "SMC-.YYYY.-"
  },
  {
   "fieldname": "contract_name",
   "fieldtype": "Data",
   "label": "Nombre del Contrato",      // ‚úÖ Espa√±ol
   "reqd": 1,
   "unique": 1
  },
  {
   "fieldname": "section_break_companies",
   "fieldtype": "Section Break",
   "label": "Informaci√≥n de las Empresas"  // ‚úÖ Espa√±ol
  },
  {
   "fieldname": "service_provider",
   "fieldtype": "Link",
   "label": "Empresa Administradora",   // ‚úÖ Espa√±ol
   "options": "Company",
   "reqd": 1
  },
  {
   "fieldname": "client_condominium",
   "fieldtype": "Link",
   "label": "Condominio Cliente",       // ‚úÖ Espa√±ol
   "options": "Company",
   "reqd": 1
  },
  {
   "fieldname": "contract_status",
   "fieldtype": "Select",
   "label": "Estado del Contrato",      // ‚úÖ Espa√±ol
   "options": "Activo\nSuspendido\nTerminado",  // ‚úÖ Opciones en espa√±ol
   "default": "Activo"
  }
  // ... m√°s campos con etiquetas en espa√±ol
 ],
 "permissions": [
  {
   "role": "System Manager",
   "read": 1,
   "write": 1,
   "create": 1,
   "delete": 1
  }
 ]
}
```

### **3.2 Child Tables - Ejemplos con Etiquetas Corregidas**

#### **Sync Data Type (Corregido)**
```json
{
 "doctype": "DocType",
 "name": "Sync Data Type",
 "module": "Companies",
 "app": "condominium_management",
 "istable": 1,
 "fields": [
  {
   "fieldname": "data_type",
   "fieldtype": "Select",
   "label": "Tipo de Dato",             // ‚úÖ Espa√±ol
   "options": "Proveedor\nArt√≠culo\nPlantilla de Email\nFormato de Impresi√≥n\nFlujo de Trabajo\nRol de Usuario\nCampo Personalizado",  // ‚úÖ Opciones en espa√±ol
   "reqd": 1,
   "in_list_view": 1
  },
  {
   "fieldname": "sync_enabled",
   "fieldtype": "Check",
   "label": "Habilitado",               // ‚úÖ Espa√±ol
   "default": 1,
   "in_list_view": 1
  }
 ]
}
```

#### **Contact Information**
```json
{
 "fields": [
  {
   "fieldname": "contact_type",
   "fieldtype": "Select",
   "label": "Tipo de Contacto",         // ‚úÖ Espa√±ol
   "options": "Administraci√≥n\nSeguridad\nMantenimiento\nEmergencias\nOtro",  // ‚úÖ Opciones en espa√±ol
   "reqd": 1,
   "in_list_view": 1
  },
  {
   "fieldname": "contact_name",
   "fieldtype": "Data",
   "label": "Nombre de Contacto",       // ‚úÖ Espa√±ol
   "in_list_view": 1
  }
 ]
}
```

---

## üá™üá∏ **PASO 4: Verificaci√≥n de Etiquetas en Espa√±ol**

### **4.1 Checklist de Verificaci√≥n**
```bash
# Script para verificar etiquetas en espa√±ol
#!/bin/bash
echo "üá™üá∏ Verificando etiquetas en espa√±ol..."

for json_file in ~/frappe-bench/apps/condominium_management/condominium_management/companies/doctype/*/*.json; do
    echo "Verificando: $json_file"
    
    # Buscar labels que podr√≠an estar en ingl√©s (patrones comunes)
    grep -n '"label":.*"[A-Z].*"' "$json_file" | grep -v "Serie\|Nombre\|Tipo\|Estado\|Fecha\|Email\|Empresa"
    
    # Buscar options que podr√≠an estar en ingl√©s
    grep -n '"options":.*"[A-Z]' "$json_file" | grep -v "MXN\|USD"
done
```

### **4.2 Patrones de Etiquetas Comunes en Espa√±ol**
```
Contract ‚Üí Contrato
Name ‚Üí Nombre  
Type ‚Üí Tipo
Status ‚Üí Estado
Date ‚Üí Fecha
Company ‚Üí Empresa
Service ‚Üí Servicio
Configuration ‚Üí Configuraci√≥n
Information ‚Üí Informaci√≥n
Details ‚Üí Detalles
Options ‚Üí Opciones
Settings ‚Üí Configuraciones
Management ‚Üí Gesti√≥n
Administration ‚Üí Administraci√≥n
```

---

## üêç **PASO 5: Archivos Python con Validaciones en Espa√±ol**

### **5.1 Mensajes de Error en Espa√±ol**
```python
# service_management_contract.py (Ejemplo)
import frappe
from frappe.model.document import Document
from frappe import _

class ServiceManagementContract(Document):
    def validate(self):
        self.validate_contract_dates()
        self.validate_companies()
    
    def validate_contract_dates(self):
        """Validar fechas del contrato"""
        if self.contract_end and self.contract_start:
            if self.contract_end < self.contract_start:
                frappe.throw(_("La fecha de fin del contrato no puede ser anterior a la fecha de inicio"))
    
    def validate_companies(self):
        """Validar que las empresas son diferentes"""
        if self.service_provider == self.client_condominium:
            frappe.throw(_("La empresa administradora no puede ser la misma que el condominio cliente"))
```

### **5.2 Mensajes Comunes en Espa√±ol**
```python
# Errores cr√≠ticos
frappe.throw(_("Campo requerido: {0}").format(field_label))
frappe.throw(_("La fecha de inicio no puede ser mayor que la fecha de fin"))
frappe.throw(_("El valor debe ser mayor que cero"))

# Advertencias
frappe.msgprint(_("Se recomienda completar este campo"), alert=True)
frappe.msgprint(_("Informaci√≥n guardada exitosamente"))

# Validaciones
if not self.contract_name:
    frappe.throw(_("El nombre del contrato es obligatorio"))
```

---

## üöÄ **PASO 6: Ejecutar Configuraci√≥n**

### **6.1 Secuencia de Comandos Final**
```bash
# 1. Ir al directorio correcto
cd ~/frappe-bench

# 2. Verificar que modules.txt es correcto
cat apps/condominium_management/condominium_management/modules.txt
# Debe mostrar: Companies

# 3. Verificar hooks.py tiene configuraci√≥n de m√≥dulos
grep -A 5 "modules = {" apps/condominium_management/condominium_management/hooks.py

# 4. Verificar etiquetas en espa√±ol (opcional)
# Ejecutar script de verificaci√≥n del PASO 4.1

# 5. Migrar
bench migrate

# 6. Construir assets
bench build

# 7. Reiniciar
bench restart
```

### **6.2 Verificaci√≥n Final**
```bash
# Verificar que DocTypes aparecen con etiquetas en espa√±ol
bench --site [sitio] console

# En console:
>>> import frappe
>>> frappe.get_meta("Service Management Contract").get_field("contract_name").label
# Debe retornar: "Nombre del Contrato"

>>> frappe.get_meta("Sync Data Type").get_field("data_type").options
# Debe retornar: "Proveedor\nArt√≠culo\n..."
```

---

## üéØ **Checklist de Validaci√≥n Final con Espa√±ol**

### **‚úÖ Configuraci√≥n Base:**
- [ ] modules.txt contiene exactamente "Companies"
- [ ] hooks.py tiene required_apps = ["frappe", "erpnext"]
- [ ] hooks.py tiene configuraci√≥n modules = {...}
- [ ] Carpeta companies/ existe con __init__.py

### **‚úÖ DocTypes:**
- [ ] 3 DocTypes principales creados
- [ ] 9 Child tables creadas
- [ ] Todos tienen archivos .py, .json, test_.py
- [ ] **JSON v√°lido con TODAS las etiquetas en espa√±ol**

### **‚úÖ Etiquetas en Espa√±ol:**
- [ ] **Todos los "label" en espa√±ol**
- [ ] **Todas las "options" de Select en espa√±ol**
- [ ] **Mensajes de error en espa√±ol en archivos .py**
- [ ] **Descripciones y help text en espa√±ol**

### **‚úÖ Funcionalidad:**
- [ ] bench migrate sin errores
- [ ] Module Def creado autom√°ticamente
- [ ] DocTypes visibles en interfaz web con etiquetas en espa√±ol
- [ ] Documentos se pueden crear y guardar

---

## üìã **Traducciones de Referencia**

### **Campos Comunes:**
```
name ‚Üí Nombre
type ‚Üí Tipo
status ‚Üí Estado
date ‚Üí Fecha
start_date ‚Üí Fecha de Inicio
end_date ‚Üí Fecha de Fin
company ‚Üí Empresa
description ‚Üí Descripci√≥n
enabled ‚Üí Habilitado
active ‚Üí Activo
configuration ‚Üí Configuraci√≥n
information ‚Üí Informaci√≥n
details ‚Üí Detalles
contact ‚Üí Contacto
address ‚Üí Direcci√≥n
phone ‚Üí Tel√©fono
email ‚Üí Email
```

### **Opciones de Select Comunes:**
```
Active ‚Üí Activo
Inactive ‚Üí Inactivo
Enabled ‚Üí Habilitado
Disabled ‚Üí Deshabilitado
Pending ‚Üí Pendiente
Completed ‚Üí Completado
In Progress ‚Üí En Progreso
Cancelled ‚Üí Cancelado
Draft ‚Üí Borrador
Submitted ‚Üí Enviado
```

---

**üìù Esta configuraci√≥n est√° validada con la regla de etiquetas en espa√±ol**
**üá™üá∏ SIEMPRE verificar que labels y options est√©n en espa√±ol**
**‚úÖ Lista para proceder con m√≥dulos siguientes aplicando estas reglas**